<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QR ë³´ë¬¼ì°¾ê¸° (V5)</title>
    <style>
        body {
            font-family: "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
            text-align: center;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            touch-action: manipulation; /* ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€ */
            user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
        }
        h1 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
        }
        #instructions {
            background-color: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 0 auto 30px;
            max-width: 500px;
            font-size: 0.95rem;
            line-height: 1.6;
            color: #555;
            text-align: left;
        }

        /* ê²Œì„ ë³´ë“œíŒ (3x3) */
        #game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ì•„ì´í…œ ì¹¸ ìŠ¤íƒ€ì¼ */
        .item-slot {
            aspect-ratio: 1 / 1;
            background-color: #fff;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            cursor: pointer;
            position: relative;
            
            /* ì°¾ì§€ ëª»í•œ ìƒíƒœ: í‘ë°± + íë¦¬ê²Œ */
            filter: grayscale(100%) opacity(0.3);
        }

        /* ì¤‘ì•™ ë³´ë¬¼ìƒì ì¹¸ */
        #chest-slot {
            font-size: 3.5rem;
            filter: none;
            opacity: 1;
            cursor: default;
        }

        /* ì°¾ì€ ìƒíƒœ */
        .item-slot.found {
            filter: grayscale(0%) opacity(1);
            background-color: #e3f2fd;
            border: 2px solid #2196F3;
            animation: bounce 0.6s;
        }

        /* ê´€ë¦¬ì ëª¨ë“œì—ì„œ ì‚­ì œ ê°€ëŠ¥ í‘œì‹œ */
        body.admin-mode .item-slot.found::after {
            content: "âŒ";
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 1rem;
            background: white;
            border-radius: 50%;
            border: 1px solid red;
        }
        
        #chest-slot.open {
            background-color: #fff8e1;
            border: 2px solid #ffc107;
            animation: spin 0.6s;
        }

        /* ìŠ¹ë¦¬ ë©”ì‹œì§€ */
        #win-message {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background-color: #fff;
            border-radius: 12px;
            border: 2px solid #FFD700;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            animation: slideUp 0.5s ease-out;
        }
        .password { 
            font-size: 1.5rem; 
            font-weight: bold; 
            color: #1976D2; 
            background: #eee; 
            padding: 5px 15px; 
            border-radius: 8px; 
        }

        /* ê´€ë¦¬ì ë²„íŠ¼ ì˜ì—­ */
        #admin-controls {
            margin-top: 50px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .admin-btn {
            background: none;
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 5px;
            color: #888;
            font-size: 0.8rem;
            cursor: pointer;
        }
        /* ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ */
        body.admin-mode {
            border: 4px solid #f44336; /* í™”ë©´ í…Œë‘ë¦¬ ë¹¨ê°„ìƒ‰ */
        }
        #reset-all-btn {
            display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 8px;
            margin-bottom: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-20px);} 60% {transform: translateY(-10px);} }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <button id="reset-all-btn" onclick="resetAllData()">âš ï¸ ì „ì²´ ë°ì´í„° ì´ˆê¸°í™” (ì²˜ìŒë¶€í„° ë‹¤ì‹œ) âš ï¸</button>

    <h1>ğŸ« ìš°ë¦¬ ë°˜ ë™ë¬¼ë†ì¥ ë³´ë¬¼ì°¾ê¸°</h1>

    <div id="instructions">
        <strong>[ì°¸ì—¬ ë°©ë²•]</strong><br>
        1. êµì‹¤ì— ìˆ¨ê²¨ì§„ <strong>QR ì½”ë“œ 8ê°œ</strong>ë¥¼ ì°¾ìœ¼ì„¸ìš”.<br>
        2. QRì„ ì°ìœ¼ë©´ ë™ë¬¼ë“¤ì´ í•˜ë‚˜ì”© ê¹¨ì–´ë‚©ë‹ˆë‹¤.<br>
        3. 8ë§ˆë¦¬ ë™ë¬¼ì„ ëª¨ë‘ ê¹¨ìš°ë©´ <strong>ë³´ë¬¼ìƒì</strong>ê°€ ì—´ë¦½ë‹ˆë‹¤!
    </div>

    <div id="game-board">
        <div class="item-slot" id="cat" onclick="handleItemClick('cat')">ğŸ±</div>
        <div class="item-slot" id="dog" onclick="handleItemClick('dog')">ğŸ¶</div>
        <div class="item-slot" id="rabbit" onclick="handleItemClick('rabbit')">ğŸ°</div>
        
        <div class="item-slot" id="bear" onclick="handleItemClick('bear')">ğŸ»</div>
        <div class="item-slot" id="chest-slot">ğŸ</div>
        <div class="item-slot" id="turtle" onclick="handleItemClick('turtle')">ğŸ¢</div>

        <div class="item-slot" id="fish" onclick="handleItemClick('fish')">ğŸ </div>
        <div class="item-slot" id="bird" onclick="handleItemClick('bird')">ğŸ¦</div>
        <div class="item-slot" id="butterfly" onclick="handleItemClick('butterfly')">ğŸ¦‹</div>
    </div>

    <div id="win-message">
        <h2>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!</h2>
        <p>ëª¨ë“  ë™ë¬¼ ì¹œêµ¬ë“¤ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.</p>
        <p>ë³´ë¬¼ìƒìì˜ ë¹„ë°€ë²ˆí˜¸ëŠ”:</p>
        <div class="password">7 2 1 9</div>
        <p>ì„ ìƒë‹˜ê»˜ ì´ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš”!</p>
    </div>

    <div id="admin-controls">
        <button class="admin-btn" onclick="toggleAdminMode()">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</button>
    </div>

    <script>
        // --- [ì„¤ì •] ---
        const MASTER_PASSWORD = "1234"; // ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (ì›í•˜ëŠ” ìˆ«ìë¡œ ë³€ê²½í•˜ì„¸ìš”)
        const items = ['cat', 'dog', 'rabbit', 'bear', 'turtle', 'fish', 'bird', 'butterfly'];
        let isAdminMode = false; // ê´€ë¦¬ì ëª¨ë“œ ìƒíƒœ

        // --- [íš¨ê³¼ìŒ ë°ì´í„° (Base64)] ---
        // ë”©ë™ (ì°¾ì•˜ì„ ë•Œ)
        const soundFound = new Audio("data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGl2ZXJ5IEZlYXR1cmVz//6UAAAAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");
        // íŒ¡íŒŒë ˆ (ì„±ê³µí–ˆì„ ë•Œ)
        const soundWin = new Audio("data:audio/mp3;base64,//6UAAAAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//6UAAxAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");
        
        // (ìš©ëŸ‰ ë¬¸ì œë¡œ ì•„ì£¼ ì§§ì€ ë¹„í”„ìŒìœ¼ë¡œ ëŒ€ì²´í–ˆìŠµë‹ˆë‹¤. ì‹¤ì œ ì‘ë™ ì‹œ 'ë¡' ì†Œë¦¬ê°€ ë‚©ë‹ˆë‹¤. 
        // ë” ì¢‹ì€ ì†Œë¦¬ë¥¼ ì›í•˜ì‹œë©´ mp3 íŒŒì¼ URLì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.)

        // ì‹¤ì œë¡œëŠ” ë” ë‚˜ì€ UXë¥¼ ìœ„í•´ ì˜¤ì‹¤ë ˆì´í„°(Web Audio API)ë¡œ 'ë ë§' ì†Œë¦¬ë¥¼ ì¦‰ì„ì—ì„œ ë§Œë“­ë‹ˆë‹¤.
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playTone(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'found') {
                // ë ë§~ (ë†’ì€ ë„ -> ë¯¸)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                osc.frequency.exponentialRampToValueAtTime(659.25, audioCtx.currentTime + 0.1); // E5
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'win') {
                // ë¹ ë°¤! (í™”ìŒ)
                playNote(523.25, 0, 0.2); // Do
                playNote(659.25, 0.2, 0.4); // Mi
                playNote(783.99, 0.4, 1.0); // Sol
            }
        }

        function playNote(freq, startTime, duration) {
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.frequency.value = freq;
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime + startTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + startTime + duration);
            osc.start(audioCtx.currentTime + startTime);
            osc.stop(audioCtx.currentTime + startTime + duration);
        }

        // --- [í•µì‹¬ ë¡œì§] ---

        document.addEventListener('DOMContentLoaded', () => {
            checkQRCode();
            updateBoard();
            
            // ì‚¬ìš©ìê°€ í™”ë©´ì„ í„°ì¹˜í•˜ë©´ ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™œì„±í™” (ëª¨ë°”ì¼ ì •ì±… ëŒ€ì‘)
            document.body.addEventListener('click', () => {
                if (audioCtx.state === 'suspended') audioCtx.resume();
            }, {once:true});
        });

        function checkQRCode() {
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');

            if (code && items.includes(code)) {
                let foundList = JSON.parse(localStorage.getItem('myAnimals')) || [];
                
                if (!foundList.includes(code)) {
                    foundList.push(code);
                    localStorage.setItem('myAnimals', JSON.stringify(foundList));
                    
                    // íš¨ê³¼ìŒ ì¬ìƒ
                    playTone('found');
                    alert('ì•¼í˜¸! ' + getEmoji(code) + 'ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!');
                }
                
                // ì£¼ì†Œì°½ ì •ë¦¬
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        function updateBoard() {
            const foundList = JSON.parse(localStorage.getItem('myAnimals')) || [];
            
            // ëª¨ë“  ìŠ¬ë¡¯ ì´ˆê¸°í™”
            items.forEach(id => {
                document.getElementById(id).classList.remove('found');
            });

            // ì°¾ì€ ê²ƒë§Œ í™œì„±í™”
            foundList.forEach(id => {
                const element = document.getElementById(id);
                if(element) element.classList.add('found');
            });

            // ìŠ¹ë¦¬ ì¡°ê±´
            if (foundList.length === items.length) {
                const chest = document.getElementById('chest-slot');
                if (!chest.classList.contains('open')) {
                    playTone('win'); // ìŠ¹ë¦¬ ì†Œë¦¬
                }
                chest.innerHTML = 'ğŸ’';
                chest.classList.add('open');
                document.getElementById('win-message').style.display = 'block';
            } else {
                // ìŠ¹ë¦¬ ì·¨ì†Œ ì‹œ (ê´€ë¦¬ì ì‚­ì œ ë“±ìœ¼ë¡œ) ë‹¤ì‹œ ë‹«ìŒ
                const chest = document.getElementById('chest-slot');
                chest.innerHTML = 'ğŸ';
                chest.classList.remove('open');
                document.getElementById('win-message').style.display = 'none';
            }
        }

        // --- [ê´€ë¦¬ì ê¸°ëŠ¥] ---

        function toggleAdminMode() {
            const input = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (input === MASTER_PASSWORD) {
                isAdminMode = !isAdminMode;
                if (isAdminMode) {
                    document.body.classList.add('admin-mode');
                    document.getElementById('reset-all-btn').style.display = 'inline-block';
                    alert("ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ ON\n\n1. ìƒë‹¨ì˜ ë¹¨ê°„ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ [ì „ì²´ ì´ˆê¸°í™”] ë©ë‹ˆë‹¤.\n2. ì´ë¯¸ ì°¾ì€ ë™ë¬¼ì„ í„°ì¹˜í•˜ë©´ [ì·¨ì†Œ] ë©ë‹ˆë‹¤.");
                } else {
                    document.body.classList.remove('admin-mode');
                    document.getElementById('reset-all-btn').style.display = 'none';
                    alert("ê´€ë¦¬ì ëª¨ë“œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
            } else {
                if(input !== null) alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
            }
        }

        function resetAllData() {
            if (confirm("ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì§€ìš°ê³  ì²˜ìŒë¶€í„° ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.removeItem('myAnimals');
                location.reload();
            }
        }

        // ì•„ì´í…œ í´ë¦­ í•¸ë“¤ëŸ¬ (ê´€ë¦¬ì ëª¨ë“œì¼ ë•Œë§Œ ì‘ë™)
        function handleItemClick(id) {
            if (!isAdminMode) return; // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ë°˜ì‘ ì—†ìŒ

            let foundList = JSON.parse(localStorage.getItem('myAnimals')) || [];
            
            // ì´ë¯¸ ì°¾ì€ ë™ë¬¼ì´ë¼ë©´ ëª©ë¡ì—ì„œ ì œê±°
            if (foundList.includes(id)) {
                if (confirm(getEmoji(id) + " íšë“ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    foundList = foundList.filter(item => item !== id);
                    localStorage.setItem('myAnimals', JSON.stringify(foundList));
                    updateBoard(); // í™”ë©´ ê°±ì‹ 
                }
            }
        }

        function getEmoji(id) {
            const emojiMap = {
                'cat': 'ğŸ±', 'dog': 'ğŸ¶', 'rabbit': 'ğŸ°', 'bear': 'ğŸ»',
                'turtle': 'ğŸ¢', 'fish': 'ğŸ ', 'bird': 'ğŸ¦', 'butterfly': 'ğŸ¦‹'
            };
            return emojiMap[id] || 'ë™ë¬¼';
        }
    </script>
</body>
</html>
